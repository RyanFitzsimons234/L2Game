<!doctype html>

<body>


    <canvas id="gameCanvas" width="600" height="600"></canvas>
    <script>
        var canvas, canvasContext, imageAssests;

        window.onload = function () {
            canvas = document.getElementById('gameCanvas');
            canvasContext = canvas.getContext('2d');
            imageAssests = loadImgAssests();

            document.addEventListener('keydown', keyPressed); //keyPressed = made function 
            document.addEventListener('keyup', keyReleased); //keyReleased = made function 

            setInterval(mainloop, 1000 / 50);
        }

        var username = '';
        while (username == '' || username == null) {
            username = prompt('what is your name?') //asks user for a name
        } // end func

        var diffculty = '';
        var pass = false;

        while (pass == false) {
            diffculty = prompt('how hard do you want it?', 'easy, medium or hard')
            diffculty = diffculty.toLowerCase()
            if (diffculty == 'easy' || diffculty == 'medium' || diffculty == 'hard' || diffculty == 'asian') {
                pass = true;
                //convert difficulty to lower case 'EaSy'
            }
        } // end func

        if (diffculty == 'easy') {
            enemyYspeed = 5;
            playerXspeed = 5;
            playerYspeed = 5;
        }

        if (diffculty == 'medium') {
            enemyYspeed = 7.5;
            playerXspeed = 7.5;
            playerYspeed = 7.5;
        }

        if (diffculty == 'hard') {
            enemyYspeed = 10;
            playerXspeed = 10;
            playerYspeed = 10;
        }
        if (diffculty == 'asian') {
            enemyYspeed = 20;
            playerXspeed = 10;
            playerYspeed = 10;
        } //changes enemyYspeed to a value based on difficulty





        var enemyYpos = 1000;
        var enemyXpos = 300;

        const RIGHT_KEY = 39;
        const LEFT_KEY = 37;
        const DOWN_KEY = 40;
        const UP_KEY = 38;

        var rightKeyPressed = false;
        var leftKeyPressed = false;
        var downKeyPressed = false;
        var upKeyPressed = false;

        var background1 = new Image();
        background1.src = "Images/background1.png";

        var enemy1 = new Image();
        enemy1.src = "Images/enemy1.png";

        var playerXsource = 0;
        var playerYsource = 0;
        const PLAYER_WIDTH = 148; // the players size within the sprite sheet
        const PLAYER_HEIGHT = 100; // the players size within the sprite sheet
        var playerXpos = 200;
        var playerYpos = 300;
        const PLAYERAWIDTH = 74; // the players size seen by the player
        const PLAYERAHEIGHT = 50; // the players size seen by the player

        var playerSpriteArray = [];
        const PLAYER_SPRITES = 8;
        var playerSpriteNum = 0;
        var playerSpriteSheetCols = 0;

        var enemies = [];
        var score = 0;
        var starting = true;
        var playing = true;
        var enemyCounter = 0;
        var ENEMY_WIDTH = 30;
        var ENEMY_HEIGHT = 200;


        function mainloop() {
            drawImg(background1, 0, 0, canvas.width, canvas.height); // bg
            drawImg(enemy1, enemyXpos, enemyYpos, ENEMY_WIDTH, ENEMY_HEIGHT);
            drawSprite(imageAssests.player, playerXsource, playerYsource, PLAYER_WIDTH, PLAYER_HEIGHT, playerXpos,
                playerYpos, PLAYERAWIDTH, PLAYERAHEIGHT);

            if (starting) {
                enemyXpos = canvas.width / 2;
                for (var i = 0; i < 10; i++) { //max of ten enemies
                    makeEnemy();
                } // makes enemies
                starting = false;
            }

            playerAnimation();
            PlayerMove();
            EnemyMove();
            drawEnemy();
            colorText('score: ' + score, 10, 20, '20px Arial', 'white') //allows the user to see the score
        } 
        

        function loadImgAssests() {
            imgs = {};

            imgs.player = new Image();
            imgs.player.src = "images/player1.png";

            return imgs;
        }

        for (i = 0; i < PLAYER_SPRITES; i++) {
            playerSpriteArray[i] = new Array(2);
            playerSpriteArray[i][0] = PLAYER_WIDTH * (i % 4);
            // console.log(playerSpriteArray[i][0]);

            if (i != 0 && i % 4 == 0) {
                playerSpriteSheetCols++;
            }
            playerSpriteArray[i][1] = PLAYER_HEIGHT * playerSpriteSheetCols;
            console.log(playerSpriteArray[i]);
        }

        function playerAnimation() {
            playerXsource = playerSpriteArray[playerSpriteNum][0];
            playerYsource = playerSpriteArray[playerSpriteNum][1];

            playerSpriteNum++;

            if (playerSpriteNum > 7) {
                playerSpriteNum = 0;

            }
        }

        function drawSprite(img, sX, sY, sW, sH, dX, dY, dW, dH) {
            canvasContext.drawImage(img, sX, sY, sW, sH, dX, dY, dW, dH)
        }

        function drawImg(src, x, y, w, h) {
            canvasContext.drawImage(src, x, y, w, h)
        }

        function keyPressed(evt) { //when key is pressed sets the key pressed to true
            console.log(evt.keyCode)
            if (evt.keyCode == RIGHT_KEY) {
                rightKeyPressed = true;
            }
            if (evt.keyCode == LEFT_KEY) {
                leftKeyPressed = true;
            }
            if (evt.keyCode == DOWN_KEY) {
                downKeyPressed = true;
            }
            if (evt.keyCode == UP_KEY) {
                upKeyPressed = true;
            }
        } //end func

        function keyReleased(evt) { // when key is released sets the key pressed to false
            console.log(evt.keyCode)
            if (evt.keyCode == RIGHT_KEY) {
                rightKeyPressed = false;
            }
            if (evt.keyCode == LEFT_KEY) {
                leftKeyPressed = false;
            }
            if (evt.keyCode == DOWN_KEY) {
                downKeyPressed = false;
            }
            if (evt.keyCode == UP_KEY) {
                upKeyPressed = false;
            }
        } //end func

        function PlayerMove() {
            if (rightKeyPressed && playerXpos < canvas.width * .87) {
                playerXpos += playerXspeed; //creates a barrier to the right for the player 
            }
            if (leftKeyPressed && playerXpos > canvas.width * .005) {
                playerXpos -= playerXspeed;
            }
            if (downKeyPressed && playerYpos < canvas.height * .8) {
                playerYpos += playerYspeed;
            }
            if (upKeyPressed && playerYpos > canvas.height * .005) {
                playerYpos -= playerYspeed;
            }
        } // end 


        // function EnemyMove() {
        //     enemyYpos -= enemyYspeed;
        //     if (enemyYpos < -50)
        //         enemyYpos = 1000; //moves enemies across the screen


        //     if (enemyXpos < playerXpos + PLAYERAWIDTH &&
        //         enemyXpos + ENEMY_WIDTH > playerXpos &&
        //         enemyYpos < playerYpos + PLAYERAHEIGHT &&
        //         enemyYpos + ENEMY_HEIGHT > playerYpos) {
        //         alert("you lose")
        //     }
        //     playing = false; // when player is touching enemies kill the player
        // }; // end func


        function drawEnemy() {
            enemies.forEach(function (e, i, array) {
                drawImg(enemy1, e.enemyXpos, e.enemyYpos, e.ENEMY_WIDTH, e.ENEMY_HEIGHT);
            }); //loops through array draws the enemy
        } // end func

        var enemyCounter = 5;

        function makeEnemy() { // gets all info for each enemy and pushes into array
            var ENEMY_WIDTH = 30;
            var ENEMY_HEIGHT = 200;
            var enemyXpos = Math.floor(Math.random() * (canvas.width- ENEMY_WIDTH));
            var enemyYpos = canvas.height + enemyCounter * (ENEMY_HEIGHT * 3); //sets enemy at random position


            enemyCounter++;

            var enemy = { //gives enemy object values
                enemyYpos: enemyYpos,
                enemyXpos: enemyXpos,
                ENEMY_WIDTH: ENEMY_WIDTH,
                ENEMY_HEIGHT: ENEMY_HEIGHT,
                enemyYspeed: enemyYspeed
            }
            enemies.push(enemy); //pushes the clones into an array

        } // end func

        function EnemyMove() {
            enemies.forEach(function (e, i, array) {

                e.enemyYpos -= e.enemyYspeed;
                if (e.enemyYpos < -500) {
                    // e.enemyYpos = canvas.height - e.ENEMY_HEIGHT 
                    e.enemyXpos = Math.floor(Math.random() * (600-1)-1);
                    e.enemyYspeed = Math.floor(Math.random(i) * (enemyYspeed - 5) + 5);
                    e.enemyYpos = 1000
                    score++; //sets enemy clones a random speed that's near the original speed
                }

                if (e.enemyXpos < playerXpos + PLAYER_WIDTH &&
                    e.enemyXpos + e.ENEMY_WIDTH > playerXpos &&
                    e.enemyYpos < playerYpos + PLAYER_HEIGHT &&
                    e.enemyYpos + e.ENEMY_HEIGHT > playerYpos) {
                    playing = false; // when player is touching enemies kill the player
                }
            });
        } // end func

            function colorText(msg, x, y, f, c) { // creates a colored text with parameters 
                canvasContext.font = f;
                canvasContext.fillStyle = c;
                canvasContext.fillText(msg, x, y);
            } //end func
    </script>
</body>